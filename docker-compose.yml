services:
  panel:
    build:
      context: ./panel
      args:
        NPM_REGISTRY: "${NPM_REGISTRY:-}"
    environment:
      ELEGANTMC_PANEL_HOST: "0.0.0.0"
      ELEGANTMC_PANEL_PORT: "3000"
      ELEGANTMC_PANEL_ADMIN_PASSWORD: "${ELEGANTMC_PANEL_ADMIN_PASSWORD:-}"
      ELEGANTMC_PANEL_SECURE_COOKIE: "${ELEGANTMC_PANEL_SECURE_COOKIE:-}"
      # For local quickstart we provide safe defaults. Override via env vars if needed.
      ELEGANTMC_DAEMON_TOKENS_JSON: "{\"${ELEGANTMC_DAEMON_ID:-local-node}\":\"${ELEGANTMC_TOKEN:-local-dev-token}\"}"
      ELEGANTMC_PANEL_DATA_DIR: "/data"
      ELEGANTMC_MOJANG_META_BASE_URL: "${ELEGANTMC_MOJANG_META_BASE_URL:-}"
    ports:
      - "${ELEGANTMC_PANEL_PORT:-3000}:3000"
    volumes:
      - elegantmc-panel-data:/data
    restart: unless-stopped

  daemon:
    build:
      context: ./daemon
      args:
        GOPROXY: "${GOPROXY:-}"
        GOSUMDB: "${GOSUMDB:-}"
    environment:
      ELEGANTMC_PANEL_WS_URL: "ws://panel:3000/ws/daemon"
      ELEGANTMC_TOKEN: "${ELEGANTMC_TOKEN:-local-dev-token}"
      ELEGANTMC_DAEMON_ID: "${ELEGANTMC_DAEMON_ID:-local-node}"
      ELEGANTMC_BASE_DIR: "/data"
      ELEGANTMC_MOJANG_META_BASE_URL: "${ELEGANTMC_MOJANG_META_BASE_URL:-}"
      ELEGANTMC_MOJANG_DATA_BASE_URL: "${ELEGANTMC_MOJANG_DATA_BASE_URL:-}"
    ports:
      - "25565-25600:25565-25600"
    volumes:
      - elegantmc-data:/data
    depends_on:
      - panel
    restart: unless-stopped

volumes:
  elegantmc-data: {}
  elegantmc-panel-data: {}
